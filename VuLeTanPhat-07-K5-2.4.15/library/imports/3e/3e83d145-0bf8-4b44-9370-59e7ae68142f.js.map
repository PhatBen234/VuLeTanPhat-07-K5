{"version":3,"sources":["assets/Day7/Script/Bai6.js"],"names":["cc","Class","Component","properties","TimeOut","Tile","Label","Body","spriteArray","type","Sprite","fetchImageWithTimeout","url","timeout","Promise","resolve","reject","controller","AbortController","signal","timeoutId","setTimeout","abort","fetch","then","response","clearTimeout","ok","Error","status","blob","img","Image","src","URL","createObjectURL","onload","onerror","err","error","name","call","urls","promises","map","all","results","i","length","result","string","texture","Texture2D","initWithElement","handleLoadedTexture","spriteFrame","SpriteFrame","console","warn","message","start"],"mappings":"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","sourceRoot":"/","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        TimeOut: 10000,\n        Tile: cc.Label,\n        Body: cc.Label,\n\n        spriteArray: {\n            default: [],\n            type: [cc.Sprite]\n        }\n    },\n\n    fetchImageWithTimeout(url, timeout) {\n        return new Promise((resolve, reject) => {\n            const controller = new AbortController(); \n            const signal = controller.signal;\n\n            const timeoutId = setTimeout(() => {\n                controller.abort();\n            }, timeout);\n\n            fetch(url, { signal })\n                .then(response => {\n                    clearTimeout(timeoutId);\n                    if (!response.ok) {\n                        throw new Error(`HTTP error! Status: ${response.status}`);\n                    }\n                    return response.blob();\n                })\n                .then(blob => {\n                    let img = new Image();\n                    img.src = URL.createObjectURL(blob);\n                    img.onload = () => resolve(img);\n                    img.onerror = err => reject(err);\n                })\n                .catch(error => {\n                    if (error.name === 'AbortError') {\n                        reject(new Error('Request timed out'));\n                    } else {\n                        reject(error);\n                    }\n                });\n        });\n    },\n\n    async call() {\n        const urls = [\n            'https://picsum.photos/id/237/300/200',\n            'https://fastly.picsum.photos/id/3/5000/3333.jpg?hmac=GDjZ2uNWE3V59PkdDaOzTOuV3tPWWxJSf4fNcxu4S2g',\n            'https://fastly.picsum.photos/id/1/5000/3333.jpg?hmac=Asv2DU3rA_5D1xSe22xZK47WEAN0wjWeFOhzd13ujW4',\n            'https://fastly.picsum.photos/id/2/5000/3333.jpg?hmac=_KDkqQVttXw_nM-RyJfLImIbafFrqLsuGO5YuHqD-qQ',\n            'https://fastly.picsum.photos/id/3/5000/3333.jpg?hmac=GDjZ2uNWE3V59PkdDaOzTOuV3tPWWxJSf4fNcxu4S2g'\n        ];\n\n        const promises = urls.map(url =>\n            this.fetchImageWithTimeout(url, this.TimeOut)\n                .then(img => ({ status: 'fulfilled', img, url }))\n                .catch(error => ({ status: 'rejected', error, url }))\n        );\n\n        const results = await Promise.all(promises);\n\n        for (let i = 0; i < results.length; i++) {\n            const result = results[i];\n\n            if (result.status === 'fulfilled') {\n                this.Tile.string = \"Image loaded:\";\n                this.Body.string = result.url;\n\n                let texture = new cc.Texture2D();\n                texture.initWithElement(result.img);\n                texture.handleLoadedTexture();\n\n                let spriteFrame = new cc.SpriteFrame(texture);\n\n                if (i < this.spriteArray.length) {\n                    this.spriteArray[i].spriteFrame = spriteFrame;\n                } else {\n                    console.warn(`No sprite available for index ${i}`);\n                }\n\n            } else {\n                this.Tile.string = \"Error:\";\n                this.Body.string = result.error.message;\n                console.error(\"Error loading image:\", result.url, result.error);\n            }\n        }\n    },\n\n    start() {\n        this.call();\n    },\n});\n\n// abort.controller co xai dc cho khac, VD: axios\n// duoc su dung o cho nao, platform nao ho tro"]}