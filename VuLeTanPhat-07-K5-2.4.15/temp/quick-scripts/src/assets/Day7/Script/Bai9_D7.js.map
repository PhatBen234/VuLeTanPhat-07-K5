{"version":3,"sources":["assets/Day7/Script/Bai9_D7.js"],"names":["cc","Class","Component","properties","outputLabel","Label","start","testCircuitBreaker","getServerTime","fetch","window","location","href","toString","method","response","dateHeader","headers","get","Error","Date","getTime","now","circuitBreaker","fn","timeThreshold","isOpen","setTimeout","getTimeLimited","result1","log","string","result2"],"mappings":";;;;;;+CACA;;;;;;AADAA,EAAE,CAACC,KAAH,CAAS;EACL,WAASD,EAAE,CAACE,SADP;EAGLC,UAAU,EAAE;IACZC,WAAW,EAAEJ,EAAE,CAACK;EADJ,CAHP;EAOLC,KAPK,mBAOG;IAAC;IACT,KAAKC,kBAAL,GADQ,CACkB;EACzB,CATI;EAWCC,aAXD,2BAWiB;IAAA;MAAA;MAAA;QAAA;UAAA;YAAA;cAAA;cAAA;cAAA,OAEKC,KAAK,CAACC,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,QAArB,EAAD,EAAkC;gBAAEC,MAAM,EAAE;cAAV,CAAlC,CAFV;;YAAA;cAEZC,QAFY;cAGZC,UAHY,GAGCD,QAAQ,CAACE,OAAT,CAAiBC,GAAjB,CAAqB,MAArB,CAHD;;cAAA,IAIbF,UAJa;gBAAA;gBAAA;cAAA;;cAAA,MAIK,IAAIG,KAAJ,CAAU,gBAAV,CAJL;;YAAA;cAAA,iCAKX,IAAIC,IAAJ,CAASJ,UAAT,EAAqBK,OAArB,EALW;;YAAA;cAAA;cAAA;cAAA,iCAOXD,IAAI,CAACE,GAAL,EAPW;;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA;EASrB,CApBI;EAsBCC,cAtBD,0BAsBgBC,EAtBhB,EAsBoBC,aAtBpB,EAsBmC;IAAA;MAAA;MAAA;QAAA;UAAA;YAAA;cAAC;cACrCC,MADoC,GAC3B,IAD2B,EACrB;;cACnBC,UAAU,CAAC,YAAM;gBACbD,MAAM,GAAG,KAAT;cACH,CAFS,EAEPD,aAFO,CAAV,CAFwC,CAItB;;cAJsB,0GAMjC;gBAAA;gBAAA;kBAAA;oBAAA;sBAAA;wBAAA,KACCC,MADD;0BAAA;0BAAA;wBAAA;;wBAAA;wBAAA,OAEUF,EAAE,MAAF,gBAFV;;sBAAA;wBAAA;;sBAAA;wBAAA,kCAII,gBAJJ;;sBAAA;sBAAA;wBAAA;oBAAA;kBAAA;gBAAA;cAAA,CANiC;;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA;EAavC,CAnCI;EAqCCjB,kBArCD,gCAqCsB;IAAA;;IAAA;MAAA;MAAA;QAAA;UAAA;YAAA;cAAA;cAAA,OACE,KAAI,CAACgB,cAAL,CAAoB,KAAI,CAACf,aAAzB,EAAwC,IAAxC,CADF;;YAAA;cACrBoB,cADqB;cACgD;cAE3ED,UAAU,0EAAC;gBAAA;gBAAA;kBAAA;oBAAA;sBAAA;wBAAA;wBAAA,OACeC,cAAc,EAD7B;;sBAAA;wBACDC,OADC;wBAEP7B,EAAE,CAAC8B,GAAH,CAAOD,OAAP;wBACA,KAAI,CAACzB,WAAL,CAAiB2B,MAAjB,GAA0B,WAAWF,OAArC;;sBAHO;sBAAA;wBAAA;oBAAA;kBAAA;gBAAA;cAAA,CAAD,IAIP,GAJO,CAAV,CAH2B,CAOnB;;cAERF,UAAU,0EAAC;gBAAA;gBAAA;kBAAA;oBAAA;sBAAA;wBAAA;wBAAA,OACeC,cAAc,EAD7B;;sBAAA;wBACDI,OADC;wBAEPhC,EAAE,CAAC8B,GAAH,CAAOE,OAAP;wBACA,KAAI,CAAC5B,WAAL,CAAiB2B,MAAjB,IAA2B,aAAaC,OAAxC;;sBAHO;sBAAA;wBAAA;oBAAA;kBAAA;gBAAA;cAAA,CAAD,IAIP,IAJO,CAAV,CAT2B,CAalB;;YAbkB;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA;EAc1B;AAnDI,CAAT","sourceRoot":"/","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n    outputLabel: cc.Label,\n    },\n\n    start() {// ngay khi node vua chay\n    this.testCircuitBreaker();// goi ngay CB\n    },\n\n    async getServerTime() {// ham lay thoi gian tu sv\n    try {\n        const response = await fetch(window.location.href.toString(), { method: 'HEAD' });\n        const dateHeader = response.headers.get('Date');\n        if (!dateHeader) throw new Error('No Date header');\n        return new Date(dateHeader).getTime();\n    } catch (e) {\n        return Date.now(); \n    }\n    },\n\n    async circuitBreaker(fn, timeThreshold) {// nhan 1 (ham async nao do, gioi han thoi gian)\n    let isOpen = true; // mo cong tac, cho phep nguoi ta call toi\n    setTimeout(() => {\n        isOpen = false;\n    }, timeThreshold);// sau khi het thoi gian quy dinh, mach dong lai, k cho goi ham fn nua\n\n    return async (...args) => {//tra ve 1 ham async moi, thay cho ham fn\n        if (isOpen) {\n        return await fn(...args);// neu con thoi gian cho goi toi fn\n        } else {\n        return \"service closed\";// het thoi gian thong bao service closed\n        }\n    };\n    },\n\n    async testCircuitBreaker() {\n    const getTimeLimited = await this.circuitBreaker(this.getServerTime, 2000);// tao 1 CB gioi han trong 2s\n\n    setTimeout(async () => {\n        const result1 = await getTimeLimited();\n        cc.log(result1);\n        this.outputLabel.string = 'KQ 1: ' + result1;\n    }, 300);// 300ms => ham nay chac chan thanh cong\n\n    setTimeout(async () => {\n        const result2 = await getTimeLimited();\n        cc.log(result2);\n        this.outputLabel.string += '\\nKQ 2: ' + result2;\n    }, 2100);// 2100ms => hon 2000ms roi, nen se bi service closed\n    }\n\n});\n"]}